<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Live Fraud Monitor — Premium UI</title>

  <!-- Premium system fonts (fallbacks included) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <!-- Lightweight icon for micro-interactions -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <style>
    :root{
      --bg-1: #050507;            /* deepest */
      --bg-2: #0f1114;            /* mid */
      --glass: rgba(255,255,255,0.04);
      --muted: rgba(255,255,255,0.6);
      --accent-1: #18a0ff;        /* electric blue */
      --accent-2: #ff4d6d;        /* rose/red for fraud */
      --success: #22c55e;
      --radius-lg: 20px;
      --radius-sm: 10px;
      --shadow-deep: 0 20px 60px rgba(2,6,23,0.7);
      --glass-border: linear-gradient(120deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      --glass-line: rgba(255,255,255,0.03);
    }

    /* Reset + base */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      min-height:100vh;
      font-family: 'Inter', system-ui, -apple-system, 'SF Pro Text', 'Roboto', 'Segoe UI', sans-serif;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(24,64,122,0.14) 0%, transparent 12%),
                  radial-gradient(1000px 480px at 90% 90%, rgba(217,48,89,0.12) 0%, transparent 12%),
                  linear-gradient(180deg, var(--bg-1) 0%, var(--bg-2) 100%);
      color: #e9eef6;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:48px;
    }

    /* Subtle animated 3D blobs (decorative) */
    .bg-blobs{position:absolute;inset:0;pointer-events:none;z-index:0;}
    .blob{
      position:absolute;filter:blur(64px) saturate(120%);opacity:0.55;mix-blend-mode:screen;border-radius:50%;
      transform-origin:center;
      will-change:transform,opacity;
    }
    .blob.b1{width:380px;height:380px;left:-60px;top:-80px;background:linear-gradient(135deg,#0ea5ff,#7c3aed);animation:blob-anim 14s ease-in-out infinite;}
    .blob.b2{width:520px;height:520px;right:-140px;bottom:-140px;background:linear-gradient(135deg,#ff5c8a,#ffb86b);animation:blob-anim 18s ease-in-out infinite reverse;}
    @keyframes blob-anim{0%{transform:translateY(0) scale(1)}50%{transform:translateY(24px) scale(1.06)}100%{transform:translateY(0) scale(1)}}

    /* Main card */
    .app-card{
      width:100%;max-width:1100px;z-index:1;border-radius:var(--radius-lg);padding:28px;position:relative;box-shadow:var(--shadow-deep);
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid var(--glass-line);
      backdrop-filter: blur(12px) saturate(120%);
      display:grid;grid-template-columns: 420px 1fr;gap:28px;align-items:start;
    }

    /* Left panel (controls + stats) */
    .left{
      padding:20px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02);
      display:flex;flex-direction:column;gap:20px;height:100%;
    }
    .brand{
      display:flex;gap:12px;align-items:center;
    }
    .logo{
      width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent-1),#6b46c1);display:flex;align-items:center;justify-content:center;box-shadow:0 8px 30px rgba(18,44,89,0.6);
      font-weight:800;font-size:18px;color:white;letter-spacing:0.6px;
    }
    .brand h1{margin:0;font-size:1.1rem;letter-spacing:0.4px}
    .brand p{margin:0;font-size:0.8rem;color:var(--muted)}

    .uploader{
      display:flex;flex-direction:column;gap:10px;margin-top:6px;
    }
    .dropzone{
      border:1px dashed rgba(255,255,255,0.05);padding:14px;border-radius:12px;display:flex;align-items:center;gap:12px;
      background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
      transition:all .22s ease;cursor:pointer;user-select:none;
    }
    .dropzone:hover{transform:translateY(-4px);box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    .dropzone input{display:none}
    .dz-text{font-size:0.95rem;color:var(--muted)}

    .controls{display:flex;gap:12px;align-items:center}
    .btn{
      display:inline-flex;align-items:center;gap:10px;padding:10px 16px;border-radius:999px;border:none;cursor:pointer;font-weight:600;letter-spacing:0.3px;
      transition:all .22s ease;box-shadow:0 8px 24px rgba(2,6,23,0.45);
    }
    .btn.preview{background:linear-gradient(90deg,var(--accent-1),#6b46c1);color:white}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}

    /* Stats */
    .stats{display:flex;flex-direction:column;gap:8px}
    .stat{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.01)}
    .stat strong{font-size:1.05rem}
    .muted{color:var(--muted);font-size:0.9rem}

    /* Right panel (timeline / table) */
    .right{padding:18px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.006));border:1px solid rgba(255,255,255,0.02);min-height:420px}
    .panel-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .panel-head h2{margin:0;font-size:1.05rem}
    .panel-head .sub{color:var(--muted);font-size:0.9rem}

    /* Table */
    table{width:100%;border-collapse:collapse;font-size:0.95rem}
    thead th{color:var(--muted);text-align:left;padding:10px 12px;font-weight:600;border-bottom:1px solid rgba(255,255,255,0.03)}
    tbody tr{transition:transform .18s ease,box-shadow .18s ease,opacity .18s ease}
    tbody tr.enter{animation:row-in .45s cubic-bezier(.2,.9,.3,1)}
    @keyframes row-in{0%{opacity:0;transform:translateY(8px) scale(.995)}100%{opacity:1;transform:none}}
    tbody td{padding:12px;border-bottom:1px solid rgba(255,255,255,0.02)}

    .tag{display:inline-flex;padding:6px 10px;border-radius:999px;font-weight:700;font-size:0.85rem;align-items:center;gap:8px}
    .tag.normal{background:rgba(255,255,255,0.02);color:var(--muted)}
    .tag.fraud{background:linear-gradient(90deg,var(--accent-2),#ff8a64);color:white;box-shadow:0 10px 30px rgba(255,77,109,0.12);}

    /* Probability chip */
    .proba{font-weight:700}
    .proba.high{color:var(--accent-2);text-shadow:0 6px 20px rgba(255,77,109,0.08)}

    /* Fraud pulse glow */
    .row-fraud{background:linear-gradient(90deg, rgba(255,77,109,0.04), rgba(255,77,109,0.02));border-left:4px solid rgba(255,77,109,0.9);box-shadow:0 8px 40px rgba(255,77,109,0.05)}

    /* Tiny toast */
    .toast{position:fixed;right:28px;bottom:28px;background:linear-gradient(180deg, rgba(10,10,10,0.9), rgba(10,10,10,0.8));padding:12px 16px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 20px 60px rgba(2,6,23,0.6);color:#fff;z-index:200}

    /* Loader */
    .dot-loader{display:inline-block;width:14px;height:14px;border-radius:50%;background:var(--accent-1);box-shadow:0 8px 22px rgba(24,144,255,0.18);animation:pop 1s infinite ease-in-out}
    @keyframes pop{0%,100%{transform:scale(.85)}50%{transform:scale(1.15)}}

    /* Responsive */
    @media (max-width:980px){
      .app-card{grid-template-columns:1fr;}
      .left{order:2}
      .right{order:1}
    }
  </style>
</head>
<body>

  <!-- decorative animated blobs -->
  <div class="bg-blobs">
    <div class="blob b1" aria-hidden="true"></div>
    <div class="blob b2" aria-hidden="true"></div>
  </div>

  <main class="app-card" role="main" aria-labelledby="app-title">

    <section class="left" aria-label="controls and stats">
      <div class="brand">
        <div class="logo">LF</div>
        <div>
          <h1 id="app-title">Live Fraud Monitor</h1>
          <p>Real-time scoring · Lightweight &amp; premium UI</p>
        </div>
      </div>

      <div class="uploader">
        <label class="dropzone" id="dropzone">
          <input id="fileInput" type="file" accept=".csv" />
          <div>
            <div class="dz-text">Drop or click to upload a CSV (single row)</div>
            <div class="muted" style="margin-top:6px;">We accept 1-row CSVs. Prediction will appear in the timeline.</div>
          </div>
        </label>

        <div class="controls">
          <button id="predictBtn" class="btn preview" aria-live="polite">
            <span class="dot-loader" aria-hidden="true"></span>
            <span>Predict</span>
          </button>

          <button id="clearBtn" class="btn secondary">Clear</button>
        </div>
      </div>

      <div class="stats" aria-hidden="false">
        <div class="stat"><div><div class="muted">Events (last 100)</div><strong id="eventsCount">0</strong></div><div class="muted">Live</div></div>
        <div class="stat"><div><div class="muted">Recent Fraud</div><strong id="recentFraud">—</strong></div><div class="muted">Timestamp</div></div>
        <div class="stat"><div><div class="muted">Highest Probability</div><strong id="highestProb">—</strong></div><div class="muted">%</div></div>
      </div>

      <div style="margin-top:auto;font-size:0.85rem;color:var(--muted)">Designed with ♥︎ — premium dark UI, gradients & subtle motion.</div>
    </section>

    <section class="right" aria-label="timeline and predictions">
      <div class="panel-head">
        <div>
          <h2>Events timeline</h2>
          <div class="sub">Latest predictions from model (auto-refresh)</div>
        </div>
        <div class="sub">Auto-refresh: <span id="autoInterval">2s</span></div>
      </div>

      <div style="overflow:auto;max-height:520px;border-radius:8px;">
        <table aria-live="polite">
          <thead>
            <tr>
              <th>Time (UTC)</th>
              <th>Class</th>
              <th style="text-align:right">Probability</th>
            </tr>
          </thead>
          <tbody id="events">
            <!-- rows injected dynamically -->
          </tbody>
        </table>
      </div>

    </section>

  </main>

  <!-- tiny toast container -->
  <div id="toastHost" aria-live="assertive" style="position:fixed;right:28px;bottom:28px;z-index:220"></div>

  <script>
    // ---- Configuration ----
    const EVENTS_ENDPOINT = '/events';
    const PREDICT_ENDPOINT = '/predict';
    const REFRESH_MS = 2000; // 2s

    // ---- Elements ----
    const eventsEl = document.getElementById('events');
    const fileInput = document.getElementById('fileInput');
    const dropzone = document.getElementById('dropzone');
    const predictBtn = document.getElementById('predictBtn');
    const clearBtn = document.getElementById('clearBtn');
    const eventsCount = document.getElementById('eventsCount');
    const recentFraud = document.getElementById('recentFraud');
    const highestProb = document.getElementById('highestProb');
    const toastHost = document.getElementById('toastHost');

    // Minimal state
    let latestEvents = [];

    // Utility: show a compact toast
    function showToast(html, ttl=3500){
      const t = document.createElement('div');
      t.className = 'toast';
      t.innerHTML = html;
      toastHost.appendChild(t);
      setTimeout(()=>{t.style.opacity='0';t.style.transform='translateY(8px)';}, ttl-400);
      setTimeout(()=>t.remove(), ttl);
    }

    // Drag & drop UX
    ['dragenter','dragover'].forEach(ev=>{
      dropzone.addEventListener(ev,e=>{e.preventDefault();dropzone.style.borderColor='rgba(255,255,255,0.12)';});
    });
    ['dragleave','drop'].forEach(ev=>{
      dropzone.addEventListener(ev,e=>{e.preventDefault();dropzone.style.borderColor='rgba(255,255,255,0.03)';});
    });
    dropzone.addEventListener('drop',e=>{
      const f = e.dataTransfer.files && e.dataTransfer.files[0];
      if(f) fileInput.files = e.dataTransfer.files;
    });

    // POST /predict (single-row CSV). Uses FormData with file input
    async function sendPredict(){
      if(!fileInput.files || fileInput.files.length===0){ showToast('No file selected'); return; }
      predictBtn.disabled = true;
      predictBtn.style.opacity = 0.8;
      const fd = new FormData(); fd.append('file', fileInput.files[0]);
      try{
        const res = await fetch(PREDICT_ENDPOINT, { method: 'POST', body: fd });
        if(!res.ok){ throw new Error('Server error ' + res.status); }
        const body = await res.json();
        // optimistic: add the returned event to UI immediately (server also stores)
        addEvent(body, true);
        fileInput.value = '';
      }catch(err){
        console.error(err); showToast('Prediction failed — check server');
      }finally{predictBtn.disabled=false;predictBtn.style.opacity=1}
    }

    // Add row to top of timeline with animation
    function addEvent(evtObj, highlight=false){
      // maintain local list
      latestEvents.unshift(evtObj);
      if(latestEvents.length>100) latestEvents.pop();
      renderEvents();

      // quick toast for fraud
      if(evtObj.label && evtObj.label.toLowerCase()!=='normal'){
        showToast(`<strong>Fraud</strong> detected — ${(evtObj.proba*100).toFixed(1)}%` , 4200);
      }
    }

    function renderEvents(){
      eventsEl.innerHTML = '';
      let maxProb = 0;
      let lastFraud = '—';
      latestEvents.forEach((e, i)=>{
        const tr = document.createElement('tr');
        tr.classList.add('enter');
        if(e.label && e.label.toLowerCase()!=='normal') { tr.classList.add('row-fraud'); }

        const timeTd = document.createElement('td');
        timeTd.textContent = (new Date(e.ts)).toISOString();
        const labelTd = document.createElement('td');
        const tag = document.createElement('span');
        tag.className = 'tag ' + (e.label!=='normal' ? 'fraud' : 'normal');
        tag.textContent = e.label.toUpperCase();
        labelTd.appendChild(tag);
        const probaTd = document.createElement('td');
        probaTd.style.textAlign='right';
        const p = (e.proba*100).toFixed(1) + '%';
        probaTd.innerHTML = `<span class="proba ${e.proba>0.6? 'high':''}">${p}</span>`;

        tr.appendChild(timeTd);tr.appendChild(labelTd);tr.appendChild(probaTd);
        eventsEl.appendChild(tr);

        if(e.proba>maxProb) maxProb = e.proba;
        if(e.label && e.label.toLowerCase()!=='normal' && lastFraud==='—') lastFraud = (new Date(e.ts)).toISOString();
      });

      eventsCount.textContent = latestEvents.length;
      recentFraud.textContent = lastFraud;
      highestProb.textContent = (maxProb*100).toFixed(1) + '%';
    }

    // Polling
    async function fetchEvents(){
      try{
        const res = await fetch(EVENTS_ENDPOINT);
        if(!res.ok) throw new Error('Bad events');
        const data = await res.json();
        // server returns array (oldest-first). We want newest-first in UI
        latestEvents = data.slice().reverse();
        if(latestEvents.length>100) latestEvents = latestEvents.slice(0,100);
        renderEvents();
      }catch(err){ console.warn('Events fetch failed',err); }
    }

    // Initial load + interval
    fetchEvents();
    const iv = setInterval(fetchEvents, REFRESH_MS);

    // UI hooks
    predictBtn.addEventListener('click', sendPredict);
    clearBtn.addEventListener('click', ()=>{ latestEvents=[]; renderEvents(); showToast('Cleared timeline',1200); });

    // Accessibility: allow Enter on dropzone to open file selector
    dropzone.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', ()=>{
      // provide immediate micro-feedback
      if(fileInput.files && fileInput.files.length>0){ showToast(fileInput.files[0].name + ' selected',1100); }
    });

    // Graceful cleanup when page unloads
    window.addEventListener('beforeunload', ()=> clearInterval(iv));
  </script>
</body>
</html>